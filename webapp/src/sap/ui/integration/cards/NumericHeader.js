/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/extend","sap/f/cards/NumericHeader","sap/f/cards/NumericHeaderRenderer","sap/f/cards/NumericSideIndicator","sap/m/library","sap/m/Text","sap/ui/core/Element","sap/ui/integration/util/BindingHelper","sap/ui/model/json/JSONModel","sap/ui/integration/util/BindingResolver","sap/ui/integration/util/LoadingProvider"],function(t,i,e,a,r,n,o,s,d,c,l){"use strict";var u=r.AvatarColor;var h=i.extend("sap.ui.integration.cards.NumericHeader",{constructor:function(e,r,o,d){r=r||{};var c={title:r.title,titleMaxLines:r.titleMaxLines,subtitle:r.subTitle,subtitleMaxLines:r.subTitleMaxLines,dataTimestamp:r.dataTimestamp,visible:r.visible,wrappingType:r.wrappingType};if(r.status&&r.status.text&&!r.status.text.format){c.statusText=r.status.text;c.statusVisible=r.status.visible}if(r.icon){var l=r.icon.initials||r.icon.text;var h=r.icon.backgroundColor||(l?u.Accent6:u.Transparent);c.iconSrc=r.icon.src;c.iconDisplayShape=r.icon.shape;c.iconInitials=l;c.iconAlt=r.icon.alt;c.iconBackgroundColor=h;c.iconVisible=r.icon.visible}if(c.iconSrc){c.iconSrc=s.formattedProperty(c.iconSrc,function(t){return d.formatSrc(t)})}t(c,{unitOfMeasurement:r.unitOfMeasurement,details:r.details?.text??r.details,detailsMaxLines:r.details?.maxLines||r.detailsMaxLines,sideIndicatorsAlignment:r.sideIndicatorsAlignment});if(r.details?.state){c.detailsState=r.details.state}if(r.mainIndicator){c.number=r.mainIndicator.number;c.scale=r.mainIndicator.unit;c.trend=r.mainIndicator.trend;c.state=r.mainIndicator.state;c.numberVisible=r.mainIndicator.visible}if(r.sideIndicators){c.sideIndicators=r.sideIndicators.map(function(t){return new a(t)})}if(r.banner){c.bannerLines=r.banner.map(function(t){var i=new n({text:t.text,visible:t.visible});if(t.diminished){i.addStyleClass("sapFCardHeaderBannerLineDiminished")}return i})}c.toolbar=o;i.call(this,e,c)},metadata:{library:"sap.ui.integration",properties:{interactive:{type:"boolean",defaultValue:false}},aggregations:{_loadingProvider:{type:"sap.ui.core.Element",multiple:false,visibility:"hidden"}},associations:{card:{type:"sap.ui.integration.widgets.Card",multiple:false}}},renderer:e});h.prototype.init=function(){i.prototype.init.call(this);this._bReady=false;this.setAggregation("_loadingProvider",new l);this._aReadyPromises=[];this._awaitEvent("_dataReady");Promise.all(this._aReadyPromises).then(function(){this._bReady=true;this.fireEvent("_ready")}.bind(this))};h.prototype.exit=function(){i.prototype.exit.call(this);this._oServiceManager=null;this._oDataProviderFactory=null;if(this._oDataProvider){this._oDataProvider.destroy();this._oDataProvider=null}if(this._oActions){this._oActions.destroy();this._oActions=null}};h.prototype.isInteractive=function(){return this.getInteractive()};h.prototype.isReady=function(){return this._bReady};h.prototype.isLoading=function(){if(!this.isReady()){return true}if(this._oDataProvider){return this.getAggregation("_loadingProvider").getLoading()}var t=this.getCardInstance();return t&&t.isLoading()};h.prototype._awaitEvent=function(t){this._aReadyPromises.push(new Promise(function(i){this.attachEventOnce(t,function(){i()})}.bind(this)))};h.prototype.setServiceManager=function(t){this._oServiceManager=t;return this};h.prototype.setDataProviderFactory=function(t){this._oDataProviderFactory=t;return this};h.prototype._setDataConfiguration=function(t){var i=this.getCardInstance(),e="/",a;if(t&&t.path){e=c.resolveValue(t.path,this.getCardInstance())}this.bindObject(e);if(this._oDataProvider){this._oDataProvider.destroy()}this._oDataProvider=this._oDataProviderFactory.create(t,this._oServiceManager);if(t&&t.name){a=i.getModel(t.name)}else if(this._oDataProvider){a=new d;this.setModel(a)}if(this._oDataProvider){this._oDataProvider.attachDataRequested(function(){this.showLoadingPlaceholders()}.bind(this));this._oDataProvider.attachDataChanged(function(t){a.setData(t.getParameter("data"));this.onDataRequestComplete()}.bind(this));this._oDataProvider.attachError(function(t){this._handleError({requestErrorParams:t.getParameters(),requestSettings:this._oDataProvider.getSettings()});this.onDataRequestComplete()}.bind(this));this._oDataProvider.triggerDataUpdate()}else{this.fireEvent("_dataReady")}};h.prototype._handleError=function(t){this.fireEvent("_error",{errorInfo:t})};h.prototype.refreshData=function(){if(this._oDataProvider){this._oDataProvider.triggerDataUpdate()}};h.prototype.showLoadingPlaceholders=function(){if(!this._isDataProviderJson()){this.getAggregation("_loadingProvider").setLoading(true)}};h.prototype.hideLoadingPlaceholders=function(){this.getAggregation("_loadingProvider").setLoading(false)};h.prototype.onDataRequestComplete=function(){this.fireEvent("_dataReady");this.hideLoadingPlaceholders()};h.prototype.getCardInstance=function(){return o.getElementById(this.getCard())};h.prototype._isDataProviderJson=function(){return this._oDataProvider&&this._oDataProvider.getSettings()&&this._oDataProvider.getSettings()["json"]};return h});
//# sourceMappingURL=NumericHeader.js.map