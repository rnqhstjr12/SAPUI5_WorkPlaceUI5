// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/base/util/uid","sap/base/util/UriParameters","sap/ui/Device","sap/ui/core/Element","sap/ui/core/EventBus","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/base/util/deepClone","sap/ushell/utils/UrlParsing","sap/ushell/utils/objectOperations","sap/ushell/utils/type","sap/ui/core/Configuration","sap/ushell/renderer/History"],function(e,t,r,n,i,a,s,jQuery,o,u,l,p,c,f,d){"use strict";var g={};g.isArray=c.isArray;g.isPlainObject=c.isPlainObject;g.isDefined=c.isDefined;g.clone=u;g.getMember=p.getMember;g.updateProperties=p.updateProperties;g.getNestedObjectProperty=p.getNestedObjectProperty;g.removeDuplicatedActions=function(e){if(Array.isArray(e)){var t=e.reduce(function(e,t){if(e.indexOf(t)<0){e.push(t)}return e},[]);return t}return e};g.storeSapSystemData=function(t,r){var n,i,a,s=[t.id];if(arguments.length>1){s.unshift(r)}try{a=JSON.stringify(t)}catch(t){e.error("Cannot stringify and store expanded system data: "+t)}if(a){i=g.getLocalStorage();n=g.generateLocalStorageKey("sap-system-data",s);i.setItem(n,a)}};g.getLocalSystemInSidFormat=function(){var e=sap.ushell.Container.getLogonSystem(),t=e.getName(),r=e.getClient();return"sid("+t+"."+r+")"};g.matchesLocalSid=function(e){return g.getLocalSystemInSidFormat().toLowerCase()===e.toLowerCase()};g.storeSapSystemToLocalStorage=function(e){var t=(e||{}).params;if(!t||!t.hasOwnProperty("sap-system")){return}if(g.isPlainObject(t["sap-system"])){var r=t["sap-system"],n=t["sap-system-src"];if(typeof n==="string"){g.storeSapSystemData(r,n);t["sap-system-src"]=n}else{g.storeSapSystemData(r)}t["sap-system"]=r.id}else if(g.matchesLocalSid(t["sap-system"])){delete t["sap-system"]}};g.setPerformanceMark=function(e,t){if(performance&&performance.mark){if(!t){t={}}if(t.bUseUniqueMark){if(t.bUseLastMark){performance.clearMarks(e)}else if(performance.getEntriesByName(e,"mark").length>0){return}}performance.mark(e)}};g.setPerformanceMeasure=function(e,t,r){if(performance&&performance.measure&&t&&r){performance.measure(e,t,r)}};g.Error=function(t,r){this.name="sap.ushell.utils.Error";this.message=t;e.error(t,null,r)};g.Error.prototype=new Error;g.localStorageSetItem=function(t,r,n){var i;try{localStorage.setItem(t,r);if(n){i=document.createEvent("StorageEvent");i.initStorageEvent("storage",false,false,t,"",r,"",localStorage);dispatchEvent(i)}}catch(t){e.warning("Error calling localStorage.setItem(): "+t,null,"sap.ushell.utils")}};g.getLocalStorage=function(){return window.localStorage};g.getLocalStorageItem=function(e){return window.localStorage.getItem(e)};g.generateUniqueId=function(e){var t,r,n;if(Array.isArray(e)){r=e;n=function(e){return r.indexOf(e)===-1}}else{n=e}do{t=g._getUid()}while(!n(t));return t};g._getUid=function(){return r()};g.reload=function(){location.reload()};g.calculateOrigin=function(e){var t;if(e.origin){return e.origin}if(e.protocol&&e.hostname){return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")}if(e.href){t=new o(e.href);return t.protocol()+"://"+t.hostname()+(t.port()?":"+t.port():"")}return undefined};g.getPrivateEpcm=function(){if(window.external&&window.external&&typeof window.external.getPrivateEpcm!=="undefined"){return window.external.getPrivateEpcm()}return undefined};g.hasNativeNavigationCapability=function(){return g.isFeatureBitEnabled(1)};g.getShellType=function(){return g.isFeatureBitEnabled(1)?"NWBC":"FLP"};g.hasNativeLogoutCapability=function(){return g.isFeatureBitEnabled(2)};g.hasNavigationModeCapability=function(){return g.isFeatureBitEnabled(4)};g.hasFLPReadyNotificationCapability=function(){return g.isFeatureBitEnabled(8)};g.hasFLPReady2NotificationCapability=function(){return g.isFeatureBitEnabled(16)};g.isFeatureBitEnabled=function(t){var r="0",n;n=g.getPrivateEpcm();if(n){try{r=n.getNwbcFeatureBits();e.debug("Detected epcm getNwbcFeatureBits returned feature bits: "+r)}catch(t){e.error("failed to get feature bit vector via call getNwbcFeatureBits on private epcm object",t.stack,"sap.ushell.utils")}}return(parseInt(r,16)&t)>0};g.isApplicationTypeEmbeddedInIframe=function(e,t){return e==="NWBC"||e==="TR"||e==="WCF"||t===true&&e==="WDA"};g.isSAPLegacyApplicationType=function(e,t,r){var n=r===true?["TR","GUI","NWBC"]:["TR","GUI","NWBC","WDA","WCF"];return n.includes(e)||n.includes(t)};g.isTRApplicationType=function(e,t){return e==="TR"||t==="TR"};g.getParamKeys=function(t){var r=[],n=[],i;if(t.indexOf("sap-intent-param=")>0){i=/(?:sap-intent-param=)([^&/]+)/.exec(t);if(i&&i.length===2){n.push("sap-intent-param-data");r.push(i[1])}}if(t.indexOf("sap-xapp-state=")>0){i=/(?:sap-xapp-state=)([^&/]+)/.exec(t);if(i&&i.length===2){n.push("sap-xapp-state-data");r.push(i[1])}}else if(t.indexOf("sap-xapp-state-data=")>0){i=/(?:sap-xapp-state-data=)([^&/]+)/.exec(t);if(i&&i.length===2){try{var a=decodeURIComponent(i[1]);n.push("sap-xapp-state-data");r.push(a)}catch(t){e.error("Invalid encoding of the sap-xapp-state-data parameter in the url: ",i[1])}}}if(t.indexOf("sap-iapp-state=")>0){i=/(?:sap-iapp-state=)([^&/]+)/.exec(t);if(i&&i.length===2){n.push("sap-iapp-state-data");r.push(i[1])}}return{aAppStateNamesArray:n,aAppStateKeysArray:r}};g.appendSapShellParamSync=function(e,t,r){var n=t==="TR"?"":"-NWBC";if(r){e+=e.indexOf("?")>=0?"&":"?";e+="sap-shell="+encodeURIComponent("FLP"+r+n)}return e};g.appendSapShellParam=async function(e,t){const r=t==="TR"?"":"-NWBC";const n=await g.getUi5Version();if(n){e+=e.indexOf("?")>=0?"&":"?";e+="sap-shell="+encodeURIComponent("FLP"+n+r)}return e};g.filterOutParamsFromLegacyAppURL=function(e){var t=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url","sap-app-origin-hint"];var r=new o(e);r=r.removeSearch(t);return r.toString()};g.getIframeFeaturePolicies=function(){return"autoplay;battery;camera;display-capture;geolocation;gyroscope;magnetometer;microphone;midi;clipboard-write;clipboard-read;fullscreen;serial;"};function h(e){var t=/\d+\.\d+\.\d+/.exec(e);if(t&&t[0]){return t[0]}return undefined}g.getUi5Version=function(){return new Promise(function(t,r){sap.ui.require(["sap/ui/VersionInfo"],function(r){r.load().then(function(e){t(h(e.version))}).catch(function(){e.error("UI5 version could not be determined.");t("")})})})};g.isNativeWebGuiNavigation=function(e){var r=t.get("applicationType",e);var n=t.get("appCapabilities.nativeNWBCNavigation",e);if(this.hasNativeNavigationCapability()&&(r==="TR"||n)){return true}return false};g.Map=function(){this.entries={}};g.Map.prototype.put=function(e,t){var r=this.get(e);this.entries[e]=t;return r};g.Map.prototype.containsKey=function(e){if(typeof e!=="string"){throw new g.Error("Not a string key: "+e,"sap.ushell.utils.Map")}return Object.prototype.hasOwnProperty.call(this.entries,e)};g.Map.prototype.get=function(e){if(this.containsKey(e)){return this.entries[e]}};g.Map.prototype.keys=function(){return Object.keys(this.entries)};g.Map.prototype.remove=function(e){delete this.entries[e]};g.Map.prototype.toString=function(){var e=["sap.ushell.utils.Map("];e.push(JSON.stringify(this.entries));e.push(")");return e.join("")};g.getParameterValueBoolean=function(e,t){var r=n.fromQuery(t||window.location.search),i=r.getAll(e),a=["true","x"],s=["false",""],o;if(!i||i.length===0){return undefined}o=i[0].toLowerCase();if(a.indexOf(o)>=0){return true}if(s.indexOf(o)>=0){return false}return undefined};g.call=function(t,r,n){var i;if(n){setTimeout(function(){g.call(t,r,false)},0);return}try{t()}catch(t){i=t.message||t.toString();e.error("Call to success handler failed: "+i,t.stack,"sap.ushell.utils");if(r){r(i)}}};g.handleTilesVisibility=function(){g.getVisibleTiles()};g.refreshTiles=function(){s.getInstance().publish("launchpad","refreshTiles")};g.setTilesNoVisibility=function(){s.getInstance().publish("launchpad","setTilesNoVisibility")};g.getBasicHash=function(t){if(!g.validHash(t)){e.debug("Utils ; getBasicHash ; Got invalid hash");return false}var r=l.parseShellHash(t);return r?r.semanticObject+"-"+r.action:t};g.validHash=function(e){return e&&e.constructor===String&&e.trim()!==""};g.getFormFactor=function(){var e=i.system;if(e.desktop){return e.SYSTEMTYPE.DESKTOP}if(e.tablet){return e.SYSTEMTYPE.TABLET}if(e.phone){return e.SYSTEMTYPE.PHONE}return undefined};g.getVisibleTiles=function(){var e=document.body.clientHeight;var t=a.getElementById("dashboardGroups");var r=a.getElementById("viewPortContainer");var n=0;var i=[];var o=[];var u=s.getInstance();var l,p,c,f,d,h,m,y,v,b,w,S,C,T,E,P,x;if(window.document.hidden){u.publish("launchpad","onHiddenTab")}if(t&&t.getGroups()&&r){S=jQuery(t.getDomRef());C=S?S.is(":visible"):false;T=t.getGroups();for(l=0;l<T.length;l=l+1){f=T[l];d=f.getTiles();h=f.getLinks();E=[d,h];for(c=0;c<E.length;c++){P=E[c];if(P){for(p=0;p<P.length;p++){m=P[p];if(!C||window.document.hidden){i.push(m)}else{y=jQuery(m.getDomRef());v=y.offset();if(v){b=y.offset().top;w=b+y.height();x=f.getVisible()&&w>n-300&&b<e+300;if(x){o.push({oTile:g.getTileModel(m),iGroup:l,bIsExtanded:!(w>n)||!(b<e)})}else if(o.length>0){u.publish("launchpad","visibleTilesChanged",o);return i}i.push(m)}}}}}}}if(o.length>0){u.publish("launchpad","visibleTilesChanged",o)}return i};g.getTileModel=function(e){var t;if(e.isA("sap.ui.integration.widgets.Card")){t=e.getBindingContext("ushellCardModel")}else{t=e.getBindingContext()}return t.getObject()?t.getObject():null};g.getTileObject=function(e){var t;if(e.isA("sap.ui.integration.widgets.Card")){t=e.getBindingContext("ushellCardModel")}else{t=e.getBindingContext()}return t.getObject()?t.getObject().object:null};g.recalculateBottomSpace=function(){var e=jQuery("#dashboardGroups").find(".sapUshellTileContainer:visible"),t=e.last(),r=jQuery(".sapUshellShellHead > header").height(),n=t.parent().height(),i=parseInt(t.find(".sapUshellContainerTitle").css("margin-top"),10),a=parseInt(jQuery(".sapUshellDashboardGroupsContainer").css("padding-bottom"),10),s;if(e.length===1){s=0}else{s=jQuery(window).height()-r-n-i-a;s=s<0?0:s}jQuery(".sapUshellDashboardGroupsContainer").css("margin-bottom",s+"px")};g.calcVisibilityModes=function(e,t){var r=true,n=true,a=e.pendingLinks&&e.pendingLinks.length?e.pendingLinks:e.links,s=g.groupHasVisibleTiles(e.tiles,a);if(!s&&(!t||e.isGroupLocked||e.isDefaultGroup||i.system.phone||i.system.tablet&&!i.system.desktop)){r=false}if(!s&&!t){n=false}return[r,n]};g.groupHasVisibleTiles=function(e,t){var r=false,n,i,a=!e?[]:e,s=!t?[]:t;a=a.concat(s);if(!a.length){return false}for(n=0;n<a.length;n=n+1){i=a[n];if(i.isTileIntentSupported){r=true;break}}return r};g.invokeUnfoldingArrayArguments=function(t,r){var n=this,i,a,s,o,u;if(!Array.isArray(r[0])){return t.apply(this,r)}i=r[0];if(i.length===0){return(new jQuery.Deferred).resolve([]).promise()}a=new jQuery.Deferred;s=[];o=[];u=(new jQuery.Deferred).resolve();i.forEach(function(r,i){if(!Array.isArray(r)){var a="Expected Array as nTh Argument of multivalue invocation: "+"first Argument must be array of array of arguments: single valued f(p1,p2), f(p1_2,p2_2), f(p1_3,p2_3) : "+"multivalued : f([[p1,p2],[p1_2,p2_2],[p1_3,p2_3]]";e.error(a);throw new Error(a)}var l=t.apply(n,r),p=new jQuery.Deferred;l.done(function(){var e=Array.prototype.slice.call(arguments);o[i]=e;p.resolve()}).fail(p.reject.bind(p));s.push(p.promise());u=jQuery.when(u,p)});jQuery.when.apply(jQuery,s).done(function(){a.resolve(o)}).fail(function(){a.reject("failure")});return a.promise()};g._getCurrentDate=function(){return new Date};g._convertToUTC=function(e){return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())};g.formatDate=function(e){var t,r,n,i,a,s;var o=sap.ui.require("sap/ushell/resources");if(!o){throw new Error("sap/ushell/resources was not required before utils.formatDate usage!")}t=g._convertToUTC(new Date(e));r=g._convertToUTC(g._getCurrentDate());n=r-t;i=parseInt(n/(1e3*60*60*24),10);if(i>0){if(i===1){return o.i18n.getText("time_day",[i])}return o.i18n.getText("time_days",[i])}a=parseInt(n/(1e3*60*60),10);if(a>0){if(a===1){return o.i18n.getText("time_hour",[a])}return o.i18n.getText("time_hours",[a])}s=parseInt(n/(1e3*60),10);if(s>0){if(s===1){return o.i18n.getText("time_minute",[s])}return o.i18n.getText("time_minutes",[s])}return o.i18n.getText("just_now")};g.toExternalWithParameters=function(e,t,r){return Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("Navigation")]).then(function(n){var i=n[0];var a=n[1];var s={};var o=t.split("&/");if(o.length>1){s.appSpecificRoute="&/"+o[1]}s.target={semanticObject:e,action:o[0]};if(r&&r.length>0){s.params={};r.forEach(function(e){s.params[e.Key]=e.Value})}return a.navigate({target:{shellHash:i.constructShellHash(s)}})})};g.moveElementInsideOfArray=function(e,t,r){if(!g.isArray(e)||t===undefined||r===undefined){throw new Error("Incorrect input parameters passed")}if(t>=e.length||r>=e.length||r<0||t<0){throw new Error("Index out of bounds")}var n=e.splice(t,1)[0];e.splice(r,0,n);return e};g.shallowMergeObject=function(e){return Array.prototype.slice.call(arguments,1,arguments.length).map(function(e){return{sourceObject:e,properties:Object.keys(e)}}).reduce(function(e,t){t.properties.forEach(function(r){e[r]=t.sourceObject[r]});return e},e)};g.getLocationHref=function(){return window.location.href};g.getLocationSearch=function(){return window.location.search};g.windowLocationReload=function(){window.location.reload(true)};g.windowLocationAssign=function(e){window.location.assign(e)};g.generateLocalStorageKey=function(e,t){var r=t.length;if(r===0){throw new Error("At least one id should be provided when generating the local storage key")}var n="$";if(r===2){n="#"}else if(r>2){n="@"+r+"@"}return e+n+t.join(":")};g.urlParametersToString=function(e,t,r){return l.privparamsToString(e,t,r)};g.isRootIntent=function(e){if(typeof e!=="string"){throw new Error("The given intent must be a string")}var r="renderers.fiori2.componentData.config.rootIntent";var n=t.get(r,window["sap-ushell-config"])||"#Shell-home";var i=n.replace("#","");var a=e.replace("#","");return a===""||a===i};g.isFlpHomeIntent=function(e){if(!e){e=window.location.hash;if(!e){e=t.get("renderers.fiori2.componentData.config.rootIntent",window["sap-ushell-config"])||"Shell-home"}}else if(typeof e!=="string"){throw new Error("The given intent must be a string")}var r=e.replace("#","");return r.indexOf("Shell-home")===0||r.indexOf("Launchpad-openFLPPage")===0||r.indexOf("Launchpad-openWorkPage")===0};g.generateRandomKey=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";var t="";var r=new window.Uint32Array(40);window.crypto.getRandomValues(r);var n=function(t){var n=r[t]%e.length;return e[n]};while(t.length<40){t+=n(t.length)}return t};g.copyToClipboard=function(e){var t;var r=document.createElement("textarea");try{r.contentEditable=true;r.readonly=false;r.textContent=e;document.documentElement.appendChild(r);r.select();document.execCommand("copy");t=true}catch(e){t=false}finally{r.parentNode.removeChild(r)}return t};g._getUserSettingPersContainer=function(){return sap.ushell.Container.getServiceAsync("PersonalizationV2").then(function(e){var t={container:"sap.ushell.usersettings.personalization",item:"data"};var r={validity:"Infinity",keyCategory:e.constants.keyCategory.GENERATED_KEY,writeFrequency:e.constants.writeFrequency.HIGH,clientStorageAllowed:false};return e.getPersonalizer(t,r)})};g.getHideEmptySpacesEnabled=function(){return new Promise(function(e){sap.ui.require(["sap/ushell/Config"],function(t){e(t)})}).then(function(e){var t=e.last("/core/spaces/hideEmptySpaces/enabled");if(!t){return Promise.resolve(false)}return g._getUserSettingPersContainer().then(function(e){return e.getPersData()}).then(function(t){var r=(t||{}).hideEmptySpaces!==false;if(e.last("/core/spaces/hideEmptySpaces/userEnabled")!==r){e.emit("/core/spaces/hideEmptySpaces/userEnabled",r)}return r})})};g.setHideEmptySpacesEnabled=function(e){return new Promise(function(e){sap.ui.require(["sap/ushell/Config"],function(t){e(t)})}).then(function(t){var r=t.last("/core/spaces/hideEmptySpaces/enabled");if(!r){return Promise.resolve()}return g._getUserSettingPersContainer().then(function(r){return r.getPersData().then(function(n){n=n||{};var i=n.hideEmptySpaces!==false;if(i===!!e){return Promise.resolve()}n.hideEmptySpaces=e;return r.setPersData(n).then(function(){t.emit("/core/spaces/hideEmptySpaces/userEnabled",e)})})})})};g.sanitizeTimeoutDelay=function(e){if(typeof e!=="number"){throw new Error("Invalid type! Expected type 'number'.")}var t=2147483647;return e>t?t:e};g.promisify=function(t){if(typeof t==="object"){if(t.done){return new Promise((r,n)=>{t.done((...t)=>{if(t.length>1){e.warning("jQuery.Deferred provided multiple return values, but only single return values are supported!")}r(t[0])}).fail(n)})}if(t.then){return t}}return Promise.resolve(t)};g.requireAsync=function(e){return new Promise(function(t,r){sap.ui.require(e,(...e)=>{t(e)},r)})};g.getThemingParameters=async function(e){const t=await new Promise((t,r)=>{sap.ui.require(["sap/ui/core/theming/Parameters"],r=>{const n=r.get({name:e,callback:t});if(n){t(n)}})});return e.map(e=>{if(typeof t==="string"){return t}else{return t[e]}})};g.isColdStart=function(){var e=sap.ushell.Container.getRendererInternal("fiori2");var t=!e||!e.getCurrentCoreView();if(d.getHistoryLength()<=1&&t){return true}else{return false}};return g},false);
//# sourceMappingURL=utils.js.map