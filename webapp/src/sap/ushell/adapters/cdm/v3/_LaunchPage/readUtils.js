// Copyright (c) 2009-2023 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/Config","sap/ushell/Container","sap/base/util/deepClone","sap/base/util/isPlainObject","sap/base/util/ObjectPath","sap/base/util/deepExtend","sap/base/util/isEmptyObject","sap/ushell/library"],function(a,t,e,i,r,n,o,s,u,c,d,p){"use strict";var l={};var v=p.DisplayFormat;var g={};l.getVizData=async function(r,n,s){if(n.isBookmark&&n.url){n=o(n);n.subTitle=n.subtitle;n.target=i.toTargetFromHash(n.url)}const u=this.getCdmParts(r,n);const d=u&&u[1]||{};const p=u&&u[3]||{};const l=a.get(r,e.getTileVizId(n))||{};const v={id:e.getTileId(n),vizId:e.getTileVizId(n)||"",vizType:n.vizType||a.getTypeId(l)||"",vizConfig:c({},d,n.vizConfig),title:a.getTitle(u)||"",subtitle:a.getSubTitle(u)||"",icon:a.getIcon(u)||"",keywords:a.getKeywords(u)||[],info:a.getInfo(u)||"",target:n.target||a.getTarget(l)||{},indicatorDataSource:this._getIndicatorDataSource(n,l,s),isBookmark:n.isBookmark||false,contentProviderId:n.contentProviderId||t.getContentProviderId(p)||"",displayFormatHint:n.displayFormatHint,numberUnit:a.getNumberUnit(u),_instantiationData:a.getInstantiationData(l)};v.target=this.harmonizeTarget(v.target);v.targetURL=i.toHashFromVizData(v,r.applications);v.contentProviderLabel=await this.getContentProviderLabel(v.contentProviderId);if(v.indicatorDataSource){if(v.indicatorDataSource.dataSource){v.dataSource=a.getDataSource(u,v.indicatorDataSource.dataSource)}else if(n.isBookmark&&n.dataSource){v.dataSource=n.dataSource}}if(n.isBookmark){this._addBookmarkInstantiationData(v,r)}if(!v._instantiationData||!Object.keys(v._instantiationData)){v._instantiationData={platform:"CDM",vizType:a.getType(r,v.vizType)}}this._evaluateDisplayFormat(v,r);return v};l.getContentProviderLabel=function(a){if(Object.hasOwn(g,a)){return g[a]}g[a]=new Promise(async t=>{try{const e=await n.getServiceAsync("ClientSideTargetResolution");const i=await e.getSystemContext(a);t(i?.label)}catch(e){t(a)}});return g[a]};l._getIndicatorDataSource=function(t,e,i){if(t.indicatorDataSource&&t.indicatorDataSource.path){if(t.contentProviderId&&i){t.indicatorDataSource.path=i.getFullyQualifiedXhrUrl(t.indicatorDataSource.path)}return t.indicatorDataSource}return a.getIndicatorDataSource(e)};l.getVizRef=function(a){var t={id:a.id,vizId:a.vizId,title:a.title,subTitle:a.subtitle,icon:a.icon,keywords:a.keywords,info:a.info,target:a.target,indicatorDataSource:a.indicatorDataSource,dataSource:a.dataSource,contentProviderId:a.contentProviderId,displayFormatHint:a.displayFormatHint,numberUnit:a.numberUnit};if(t.indicatorDataSource&&t.indicatorDataSource.originalPath){t.indicatorDataSource.path=t.indicatorDataSource.originalPath;delete t.indicatorDataSource.originalPath}if(a.isBookmark){t.isBookmark=a.isBookmark;if(a.vizConfig!==undefined&&!d(a.vizConfig)){t.vizType=a.vizType;if(a.cdmVizType){t.vizType=a.cdmVizType}t.vizConfig=a.vizConfig}}return t};l.getCdmParts=function(i,r){var n=a.get(i,e.getTileVizId(r))||{};var o=a.getConfig(n);var s=a.getAppDescriptor(i,a.getAppId(n));var u=t.getInbound(s,a.getInboundId(n));return[r,o,u,s]};l.harmonizeTarget=function(a){var t=a.parameters;var e={};if(!t){return a}if(Array.isArray(t)){t.forEach(function(a){if(e[a.name]){if(!Array.isArray(e[a.name].value.value)){e[a.name].value.value=[e[a.name].value.value]}e[a.name].value.value.push(a.value)}else{e[a.name]={value:{value:a.value,format:"plain"}}}})}else{e=Object.keys(t).reduce((a,e)=>{if(!t[e].value||!t[e].value.hasOwnProperty("value")){t[e]={value:t[e]}}return{...a,[e]:t[e]}},{})}a.parameters=e;return a};l._evaluateDisplayFormat=function(t,e){var i=t.displayFormatHint;var r=a.getType(e,t.vizType);var n=a.getTileSize(r);var o=n==="1x2"?v.StandardWide:v.Standard;var s=[o,v.Compact];t.supportedDisplayFormats=a.getSupportedDisplayFormats(r)||s;var u=a.getDefaultDisplayFormat(r)||o;if(t.supportedDisplayFormats.indexOf(i)===-1){t.displayFormatHint=u}};l._addBookmarkInstantiationData=function(t,e){if(t.vizType){var i=a.getType(e,t.vizType);var r=u.get(["sap.app","type"],i||{});if(i&&r!=="chipVizType"){t._instantiationData={platform:"CDM",vizType:i}}else{var n=a.getChipConfigFromVizReference(t);t._instantiationData={platform:"ABAP",chip:o(n),simplifiedChipFormat:true};t.cdmVizType=t.vizType;t.vizType=n.chipId}}else if(t.indicatorDataSource&&t.indicatorDataSource.path){t.vizType="sap.ushell.DynamicAppLauncher"}else{t.vizType="sap.ushell.StaticAppLauncher"}};l.getBookmarkVizTypeIds=function(t){var e=["sap.ushell.StaticAppLauncher","sap.ushell.DynamicAppLauncher"];var i=t.vizType;if(i&&!e.includes(i)){e.push(i)}var r=a.getChipConfigFromVizReference(t);var n=r&&r.chipId;if(n&&!e.includes(n)){e.push(n)}return e};return l});
//# sourceMappingURL=readUtils.js.map